import{u as X,D as Y}from"./DashboardLayout-DbTTL_t5.js";import{u as ee}from"./episodes-JgSeD8Dm.js";import{u as le,a as oe,n as te,r as v,j as y,k as ae,l as ie,w as r,e as d,p as se,o as re,d as t,b as i,h,i as T,t as A,s as de,v as ne,x as I}from"./index-CCGy0HCw.js";import{I as ue}from"./ImageUpload-p5VQoxmW.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const me={class:"filters"},ce={class:"stats-chips"},ve={class:"empty-state"},fe={class:"action-buttons"},be={class:"dialog-content"},we={class:"form-field"},ge={class:"form-row"},ye={class:"form-field"},he={class:"form-field"},De={class:"form-field"},Ve={class:"form-field"},Ce={class:"form-field"},_e={class:"form-row"},xe={class:"form-field"},Ie={class:"form-field"},Ee={class:"form-row"},Se={class:"form-field"},Ue={__name:"EpisodesView",setup(Ne){const s=ee(),D=X();le();const n=oe(),z=te(),f=v(!1),m=v(null),b=v(null),w=v(null),c=v(""),a=v({showId:"",title:"",episodeNumber:null,description:"",mixcloudUrl:"",image:{url:"",alt:""},airDate:new Date,genres:[],status:"draft",featured:!1}),E=[{label:"Bozza",value:"draft"},{label:"Pubblicato",value:"published"},{label:"Archiviato",value:"archived"}],k=y(()=>{if(!Array.isArray(s.episodes))return console.warn("episodesStore.episodes non è un array:",s.episodes),[];let l=s.episodes;return b.value&&(l=l.filter(e=>e.showId?._id===b.value||e.showId===b.value)),w.value&&(l=l.filter(e=>e.status===w.value)),l}),L=y(()=>Array.isArray(s.episodes)?s.episodes.filter(l=>l.status==="published").length:0),$=y(()=>Array.isArray(s.episodes)?s.episodes.filter(l=>l.status==="draft").length:0),B=y(()=>Array.isArray(s.episodes)?s.episodes.filter(l=>l.featured).length:0),M=l=>({draft:"BOZZA",published:"PUBBLICATO",archived:"ARCHIVIATO"})[l]||l.toUpperCase(),O=l=>({draft:"secondary",published:"success",archived:"warning"})[l]||"info",F=l=>l?new Date(l).toLocaleDateString("it-IT",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",V=(l=null)=>{l?(m.value=l,a.value={showId:l.showId?._id||l.showId,title:l.title,episodeNumber:l.episodeNumber,description:l.description,mixcloudUrl:l.mixcloudUrl,image:{url:l.image?.url||"",alt:l.image?.alt||""},airDate:new Date(l.airDate),genres:l.genres||[],status:l.status,featured:l.featured},c.value=(l.genres||[]).join(", ")):(m.value=null,a.value={showId:"",title:"",episodeNumber:null,description:"",mixcloudUrl:"",image:{url:"",alt:""},airDate:new Date,genres:[],status:"draft",featured:!1},c.value=""),f.value=!0},q=async()=>{if(!a.value.showId||!a.value.title||!a.value.description||!a.value.mixcloudUrl){n.add({severity:"warn",summary:"Campi mancanti",detail:"Compila tutti i campi obbligatori",life:3e3});return}const l={showId:a.value.showId,title:a.value.title,episodeNumber:a.value.episodeNumber,description:a.value.description,mixcloudUrl:a.value.mixcloudUrl,image:a.value.image.url?a.value.image:void 0,airDate:a.value.airDate instanceof Date?a.value.airDate.toISOString():a.value.airDate,genres:c.value?c.value.split(",").map(e=>e.trim()).filter(e=>e):[],status:a.value.status,featured:a.value.featured};try{m.value?(await s.updateEpisode(m.value._id,l),n.add({severity:"success",summary:"Episodio aggiornato",detail:"Le modifiche sono state salvate",life:3e3})):(await s.createEpisode(l),n.add({severity:"success",summary:"Episodio creato",detail:"Il nuovo episodio è stato creato",life:3e3})),f.value=!1}catch{n.add({severity:"error",summary:"Errore",detail:s.error||"Errore durante il salvataggio",life:3e3})}},R=l=>{alert(`Dettagli episodio:

Titolo: ${l.title}
Show: ${l.showId?.title}
Mixcloud: ${l.mixcloudUrl}`)},j=l=>{z.require({message:`Sei sicuro di voler eliminare "${l.title}"?`,header:"Conferma Eliminazione",icon:"pi pi-exclamation-triangle",acceptLabel:"Sì, elimina",rejectLabel:"Annulla",acceptClass:"p-button-danger",accept:()=>G(l)})},G=async l=>{try{await s.deleteEpisode(l._id),n.add({severity:"success",summary:"Episodio eliminato",detail:"L'episodio è stato eliminato",life:3e3})}catch{n.add({severity:"error",summary:"Errore",detail:"Errore durante l'eliminazione",life:3e3})}};return ae(async()=>{try{await Promise.all([s.fetchEpisodes(),D.fetchShows()])}catch{n.add({severity:"error",summary:"Errore",detail:"Errore nel caricamento dei dati",life:3e3})}}),(l,e)=>{const u=d("Button"),g=d("Dropdown"),C=d("Chip"),S=d("Card"),p=d("Column"),U=d("Tag"),H=d("DataTable"),_=d("InputText"),Z=d("InputNumber"),J=d("Textarea"),K=d("Calendar"),P=d("Dialog"),Q=d("ConfirmDialog"),W=d("Toast"),x=se("tooltip");return re(),ie(Y,{"page-title":"Gestione Episodi"},{"topbar-actions":r(()=>[t(u,{label:"Nuovo Episodio",icon:"pi pi-plus",onClick:e[0]||(e[0]=o=>V())})]),default:r(()=>[t(S,{class:"filters-card"},{content:r(()=>[i("div",me,[t(g,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=o=>b.value=o),options:h(D).shows.filter(o=>o.status==="active"),optionLabel:"title",optionValue:"_id",placeholder:"Filtra per Show",showClear:"",class:"filter-dropdown"},null,8,["modelValue","options"]),t(g,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=o=>w.value=o),options:E,optionLabel:"label",optionValue:"value",placeholder:"Filtra per Status",showClear:"",class:"filter-dropdown"},null,8,["modelValue"]),i("div",ce,[t(C,{label:`${L.value} Pubblicati`,icon:"pi pi-check-circle"},null,8,["label"]),t(C,{label:`${$.value} Bozze`,icon:"pi pi-pencil"},null,8,["label"]),t(C,{label:`${B.value} In evidenza`,icon:"pi pi-star-fill"},null,8,["label"])])])]),_:1}),t(S,null,{content:r(()=>[t(H,{value:k.value,loading:h(s).loading,paginator:"",rows:15,stripedRows:"",sortField:"airDate",sortOrder:-1},{empty:r(()=>[i("div",ve,[e[15]||(e[15]=i("i",{class:"pi pi-play-circle",style:{"font-size":"3rem",color:"#cbd5e1"}},null,-1)),e[16]||(e[16]=i("p",null,"Nessun episodio trovato",-1)),t(u,{label:"Crea il primo episodio",icon:"pi pi-plus",onClick:e[3]||(e[3]=o=>V())})])]),default:r(()=>[t(p,{field:"title",header:"Titolo",sortable:"",style:{"min-width":"200px"}}),t(p,{field:"showId.title",header:"Show",sortable:""},{body:r(o=>[t(U,{value:o.data.showId?.title||"-",severity:"info"},null,8,["value"])]),_:1}),t(p,{field:"episodeNumber",header:"#",sortable:"",style:{width:"80px"}},{body:r(o=>[T(A(o.data.episodeNumber||"-"),1)]),_:1}),t(p,{field:"airDate",header:"Data Messa in Onda",sortable:""},{body:r(o=>[T(A(F(o.data.airDate)),1)]),_:1}),t(p,{field:"status",header:"Status",sortable:""},{body:r(o=>[t(U,{value:M(o.data.status),severity:O(o.data.status)},null,8,["value","severity"])]),_:1}),t(p,{field:"featured",header:"Featured",sortable:"",style:{width:"100px"}},{body:r(o=>[i("i",{class:ne(o.data.featured?"pi pi-star-fill":"pi pi-star"),style:de({color:o.data.featured?"#f59e0b":"#cbd5e1",fontSize:"1.2rem"})},null,6)]),_:1}),t(p,{header:"Azioni",style:{width:"200px"}},{body:r(o=>[i("div",fe,[I(t(u,{icon:"pi pi-eye",rounded:"",outlined:"",severity:"info",onClick:N=>R(o.data)},null,8,["onClick"]),[[x,"Dettagli",void 0,{top:!0}]]),I(t(u,{icon:"pi pi-pencil",rounded:"",outlined:"",severity:"secondary",onClick:N=>V(o.data)},null,8,["onClick"]),[[x,"Modifica",void 0,{top:!0}]]),I(t(u,{icon:"pi pi-trash",rounded:"",outlined:"",severity:"danger",onClick:N=>j(o.data)},null,8,["onClick"]),[[x,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"])]),_:1}),t(P,{visible:f.value,"onUpdate:visible":e[14]||(e[14]=o=>f.value=o),header:m.value?"Modifica Episodio":"Nuovo Episodio",modal:!0,style:{width:"800px"},maximizable:!0},{footer:r(()=>[t(u,{label:"Annulla",severity:"secondary",onClick:e[13]||(e[13]=o=>f.value=!1),outlined:""}),t(u,{label:m.value?"Salva Modifiche":"Crea Episodio",onClick:q,loading:h(s).loading},null,8,["label","loading"])]),default:r(()=>[i("div",be,[i("div",we,[e[17]||(e[17]=i("label",{for:"showId"},"Show *",-1)),t(g,{id:"showId",modelValue:a.value.showId,"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.showId=o),options:h(D).shows.filter(o=>o.status==="active"),optionLabel:"title",optionValue:"_id",placeholder:"Seleziona lo show",required:"",class:"w-full"},null,8,["modelValue","options"])]),i("div",ge,[i("div",ye,[e[18]||(e[18]=i("label",{for:"title"},"Titolo Episodio *",-1)),t(_,{id:"title",modelValue:a.value.title,"onUpdate:modelValue":e[5]||(e[5]=o=>a.value.title=o),placeholder:"Es. Episode #12 - Deep Techno Night",required:"",class:"w-full"},null,8,["modelValue"])]),i("div",he,[e[19]||(e[19]=i("label",{for:"episodeNumber"},"Numero Episodio",-1)),t(Z,{id:"episodeNumber",modelValue:a.value.episodeNumber,"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.episodeNumber=o),placeholder:"12",min:1,class:"w-full"},null,8,["modelValue"])])]),i("div",De,[e[20]||(e[20]=i("label",{for:"description"},"Descrizione *",-1)),t(J,{id:"description",modelValue:a.value.description,"onUpdate:modelValue":e[7]||(e[7]=o=>a.value.description=o),rows:"4",placeholder:"Descrivi l'episodio, la tracklist, gli ospiti...",required:"",class:"w-full"},null,8,["modelValue"])]),i("div",Ve,[e[21]||(e[21]=i("label",{for:"mixcloudUrl"},"Mixcloud URL *",-1)),t(_,{id:"mixcloudUrl",modelValue:a.value.mixcloudUrl,"onUpdate:modelValue":e[8]||(e[8]=o=>a.value.mixcloudUrl=o),placeholder:"https://www.mixcloud.com/username/episode-name/",required:"",class:"w-full"},null,8,["modelValue"]),e[22]||(e[22]=i("small",null,"URL completo del mix su Mixcloud",-1))]),i("div",Ce,[t(ue,{label:"Immagine Episodio (opzionale)",modelValue:a.value.image.url,"onUpdate:modelValue":e[9]||(e[9]=o=>a.value.image.url=o)},null,8,["modelValue"]),e[23]||(e[23]=i("small",null,"Se non specificata, verrà usata l'immagine dello show",-1))]),i("div",_e,[i("div",xe,[e[24]||(e[24]=i("label",{for:"airDate"},"Data Messa in Onda *",-1)),t(K,{id:"airDate",modelValue:a.value.airDate,"onUpdate:modelValue":e[10]||(e[10]=o=>a.value.airDate=o),showTime:"",hourFormat:"24",dateFormat:"dd/mm/yy",showIcon:"",class:"w-full"},null,8,["modelValue"])]),i("div",Ie,[e[25]||(e[25]=i("label",{for:"genres"},"Generi Musicali",-1)),t(_,{id:"genres",modelValue:c.value,"onUpdate:modelValue":e[11]||(e[11]=o=>c.value=o),placeholder:"Techno, House, Ambient",class:"w-full"},null,8,["modelValue"]),e[26]||(e[26]=i("small",null,"Separati da virgola",-1))])]),i("div",Ee,[i("div",Se,[e[27]||(e[27]=i("label",{for:"status"},"Status",-1)),t(g,{id:"status",modelValue:a.value.status,"onUpdate:modelValue":e[12]||(e[12]=o=>a.value.status=o),options:E,optionLabel:"label",optionValue:"value",placeholder:"Seleziona status",class:"w-full"},null,8,["modelValue"])])])])]),_:1},8,["visible","header"]),t(Q),t(W)]),_:1})}}},$e=pe(Ue,[["__scopeId","data-v-d3081cd8"]]);export{$e as default};
