import{u as Y,D as ee}from"./DashboardLayout-pOp1z0Uu.js";import{u as le}from"./episodes-B4waFnAc.js";import{u as oe,a as te,n as ae,r as v,j as y,k as ie,l as se,w as r,e as s,p as re,o as de,d as a,b as i,h,i as T,t as k,s as ne,v as ue,x as E}from"./index-DvqxKvF9.js";import{I as pe}from"./ImageUpload-B14NK2BC.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ce={class:"filters"},ve={class:"stats-chips"},fe={class:"empty-state"},be={class:"action-buttons"},we={class:"dialog-content"},ge={class:"form-field"},ye={class:"form-row"},he={class:"form-field"},Ve={class:"form-field"},De={class:"form-field"},Ce={class:"form-field"},_e={class:"form-field"},xe={class:"form-row"},Ee={class:"form-field"},Ie={class:"form-field"},Se={class:"form-row"},Ue={class:"form-field"},Ne={class:"form-field"},Te={class:"checkbox-field"},ke={__name:"EpisodesView",setup(ze){const d=le(),V=Y();oe();const n=te(),z=ae(),f=v(!1),m=v(null),b=v(null),w=v(null),c=v(""),t=v({showId:"",title:"",episodeNumber:null,description:"",mixcloudUrl:"",image:{url:"",alt:""},airDate:new Date,genres:[],status:"draft",featured:!1}),I=[{label:"Bozza",value:"draft"},{label:"Pubblicato",value:"published"},{label:"Archiviato",value:"archived"}],L=y(()=>{if(!Array.isArray(d.episodes))return[];let o=[...d.episodes];return b.value&&(o=o.filter(e=>e.showId?._id===b.value||e.showId===b.value)),w.value&&(o=o.filter(e=>e.status===w.value)),o}),$=y(()=>d.publishedEpisodes.length),A=y(()=>d.draftEpisodes.length),M=y(()=>d.featuredEpisodes.length),B=o=>({draft:"BOZZA",published:"PUBBLICATO",archived:"ARCHIVIATO"})[o]||o.toUpperCase(),O=o=>({draft:"secondary",published:"success",archived:"warning"})[o]||"info",F=o=>o?new Date(o).toLocaleDateString("it-IT",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",D=(o=null)=>{o?(m.value=o,t.value={showId:o.showId?._id||o.showId,title:o.title,episodeNumber:o.episodeNumber,description:o.description,mixcloudUrl:o.mixcloudUrl,image:{url:o.image?.url||"",alt:o.image?.alt||""},airDate:new Date(o.airDate),genres:o.genres||[],status:o.status,featured:o.featured},c.value=(o.genres||[]).join(", ")):(m.value=null,t.value={showId:"",title:"",episodeNumber:null,description:"",mixcloudUrl:"",image:{url:"",alt:""},airDate:new Date,genres:[],status:"draft",featured:!1},c.value=""),f.value=!0},q=async()=>{if(!t.value.showId||!t.value.title||!t.value.description||!t.value.mixcloudUrl){n.add({severity:"warn",summary:"Campi mancanti",detail:"Compila tutti i campi obbligatori",life:3e3});return}console.log("epis",t.value.showId);const o={showId:t.value.showId,title:t.value.title,episodeNumber:t.value.episodeNumber,description:t.value.description,mixcloudUrl:t.value.mixcloudUrl,image:t.value.image.url?t.value.image:void 0,airDate:t.value.airDate instanceof Date?t.value.airDate.toISOString():t.value.airDate,genres:c.value?c.value.split(",").map(e=>e.trim()).filter(e=>e):[],status:t.value.status,featured:t.value.featured};try{m.value?(await d.updateEpisode(m.value._id,o),n.add({severity:"success",summary:"Episodio aggiornato",detail:"Le modifiche sono state salvate",life:3e3})):(await d.createEpisode(o),n.add({severity:"success",summary:"Episodio creato",detail:"Il nuovo episodio è stato creato",life:3e3})),f.value=!1}catch{n.add({severity:"error",summary:"Errore",detail:d.error||"Errore durante il salvataggio",life:3e3})}},R=o=>{alert(`Dettagli episodio:

Titolo: ${o.title}
Show: ${o.showId?.title}
Mixcloud: ${o.mixcloudUrl}`)},j=o=>{z.require({message:`Sei sicuro di voler eliminare "${o.title}"?`,header:"Conferma Eliminazione",icon:"pi pi-exclamation-triangle",acceptLabel:"Sì, elimina",rejectLabel:"Annulla",acceptClass:"p-button-danger",accept:()=>G(o)})},G=async o=>{try{await d.deleteEpisode(o._id),n.add({severity:"success",summary:"Episodio eliminato",detail:"L'episodio è stato eliminato",life:3e3})}catch{n.add({severity:"error",summary:"Errore",detail:"Errore durante l'eliminazione",life:3e3})}};return ie(async()=>{try{await Promise.all([d.fetchEpisodes(),V.fetchShows()])}catch(o){console.log(o),n.add({severity:"error",summary:"Errore",detail:"Errore nel caricamento dei dati",life:1e5})}}),(o,e)=>{const u=s("Button"),g=s("Dropdown"),C=s("Chip"),S=s("Card"),p=s("Column"),U=s("Tag"),H=s("DataTable"),_=s("InputText"),Z=s("InputNumber"),J=s("Textarea"),K=s("Calendar"),P=s("Checkbox"),Q=s("Dialog"),W=s("ConfirmDialog"),X=s("Toast"),x=re("tooltip");return de(),se(ee,{"page-title":"Gestione Episodi"},{"topbar-actions":r(()=>[a(u,{label:"Nuovo Episodio",icon:"pi pi-plus",onClick:e[0]||(e[0]=l=>D())})]),default:r(()=>[a(S,{class:"filters-card"},{content:r(()=>[i("div",ce,[a(g,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=l=>b.value=l),options:h(V).shows.filter(l=>l.status==="active"),optionLabel:"title",optionValue:"_id",placeholder:"Filtra per Show",showClear:"",class:"filter-dropdown"},null,8,["modelValue","options"]),a(g,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=l=>w.value=l),options:I,optionLabel:"label",optionValue:"value",placeholder:"Filtra per Status",showClear:"",class:"filter-dropdown"},null,8,["modelValue"]),i("div",ve,[a(C,{label:`${$.value} Pubblicati`,icon:"pi pi-check-circle"},null,8,["label"]),a(C,{label:`${A.value} Bozze`,icon:"pi pi-pencil"},null,8,["label"]),a(C,{label:`${M.value} In evidenza`,icon:"pi pi-star-fill"},null,8,["label"])])])]),_:1}),a(S,null,{content:r(()=>[a(H,{value:L.value,loading:h(d).loading,paginator:"",rows:15,stripedRows:"",sortField:"airDate",sortOrder:-1},{empty:r(()=>[i("div",fe,[e[16]||(e[16]=i("i",{class:"pi pi-play-circle",style:{"font-size":"3rem",color:"#cbd5e1"}},null,-1)),e[17]||(e[17]=i("p",null,"Nessun episodio trovato",-1)),a(u,{label:"Crea il primo episodio",icon:"pi pi-plus",onClick:e[3]||(e[3]=l=>D())})])]),default:r(()=>[a(p,{field:"title",header:"Titolo",sortable:"",style:{"min-width":"200px"}}),a(p,{field:"showId.title",header:"Show",sortable:""},{body:r(l=>[a(U,{value:l.data.showId?.title||"-",severity:"info"},null,8,["value"])]),_:1}),a(p,{field:"episodeNumber",header:"#",sortable:"",style:{width:"80px"}},{body:r(l=>[T(k(l.data.episodeNumber||"-"),1)]),_:1}),a(p,{field:"airDate",header:"Data Messa in Onda",sortable:""},{body:r(l=>[T(k(F(l.data.airDate)),1)]),_:1}),a(p,{field:"status",header:"Status",sortable:""},{body:r(l=>[a(U,{value:B(l.data.status),severity:O(l.data.status)},null,8,["value","severity"])]),_:1}),a(p,{field:"featured",header:"Featured",sortable:"",style:{width:"100px"}},{body:r(l=>[i("i",{class:ue(l.data.featured?"pi pi-star-fill":"pi pi-star"),style:ne({color:l.data.featured?"#f59e0b":"#cbd5e1",fontSize:"1.2rem"})},null,6)]),_:1}),a(p,{header:"Azioni",style:{width:"200px"}},{body:r(l=>[i("div",be,[E(a(u,{icon:"pi pi-eye",rounded:"",outlined:"",severity:"info",onClick:N=>R(l.data)},null,8,["onClick"]),[[x,"Dettagli",void 0,{top:!0}]]),E(a(u,{icon:"pi pi-pencil",rounded:"",outlined:"",severity:"secondary",onClick:N=>D(l.data)},null,8,["onClick"]),[[x,"Modifica",void 0,{top:!0}]]),E(a(u,{icon:"pi pi-trash",rounded:"",outlined:"",severity:"danger",onClick:N=>j(l.data)},null,8,["onClick"]),[[x,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"])]),_:1}),a(Q,{visible:f.value,"onUpdate:visible":e[15]||(e[15]=l=>f.value=l),header:m.value?"Modifica Episodio":"Nuovo Episodio",modal:!0,style:{width:"800px"},maximizable:!0},{footer:r(()=>[a(u,{label:"Annulla",severity:"secondary",onClick:e[14]||(e[14]=l=>f.value=!1),outlined:""}),a(u,{label:m.value?"Salva Modifiche":"Crea Episodio",onClick:q,loading:h(d).loading},null,8,["label","loading"])]),default:r(()=>[i("div",we,[i("div",ge,[e[18]||(e[18]=i("label",{for:"showId"},"Show *",-1)),a(g,{id:"showId",modelValue:t.value.showId,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.showId=l),options:h(V).shows.filter(l=>l.status==="active"),optionLabel:"title",optionValue:"_id",placeholder:"Seleziona lo show",required:"",class:"w-full"},null,8,["modelValue","options"])]),i("div",ye,[i("div",he,[e[19]||(e[19]=i("label",{for:"title"},"Titolo Episodio *",-1)),a(_,{id:"title",modelValue:t.value.title,"onUpdate:modelValue":e[5]||(e[5]=l=>t.value.title=l),placeholder:"Es. Episode #12 - Deep Techno Night",required:"",class:"w-full"},null,8,["modelValue"])]),i("div",Ve,[e[20]||(e[20]=i("label",{for:"episodeNumber"},"Numero Episodio",-1)),a(Z,{id:"episodeNumber",modelValue:t.value.episodeNumber,"onUpdate:modelValue":e[6]||(e[6]=l=>t.value.episodeNumber=l),placeholder:"12",min:1,class:"w-full"},null,8,["modelValue"])])]),i("div",De,[e[21]||(e[21]=i("label",{for:"description"},"Descrizione *",-1)),a(J,{id:"description",modelValue:t.value.description,"onUpdate:modelValue":e[7]||(e[7]=l=>t.value.description=l),rows:"4",placeholder:"Descrivi l'episodio, la tracklist, gli ospiti...",required:"",class:"w-full"},null,8,["modelValue"])]),i("div",Ce,[e[22]||(e[22]=i("label",{for:"mixcloudUrl"},"Mixcloud URL *",-1)),a(_,{id:"mixcloudUrl",modelValue:t.value.mixcloudUrl,"onUpdate:modelValue":e[8]||(e[8]=l=>t.value.mixcloudUrl=l),placeholder:"https://www.mixcloud.com/username/episode-name/",required:"",class:"w-full"},null,8,["modelValue"]),e[23]||(e[23]=i("small",null,"URL completo del mix su Mixcloud",-1))]),i("div",_e,[a(pe,{label:"Immagine Episodio (opzionale)",modelValue:t.value.image.url,"onUpdate:modelValue":e[9]||(e[9]=l=>t.value.image.url=l)},null,8,["modelValue"]),e[24]||(e[24]=i("small",null,"Se non specificata, verrà usata l'immagine dello show",-1))]),i("div",xe,[i("div",Ee,[e[25]||(e[25]=i("label",{for:"airDate"},"Data Messa in Onda *",-1)),a(K,{id:"airDate",modelValue:t.value.airDate,"onUpdate:modelValue":e[10]||(e[10]=l=>t.value.airDate=l),showTime:"",hourFormat:"24",dateFormat:"dd/mm/yy",showIcon:"",class:"w-full"},null,8,["modelValue"])]),i("div",Ie,[e[26]||(e[26]=i("label",{for:"genres"},"Generi Musicali",-1)),a(_,{id:"genres",modelValue:c.value,"onUpdate:modelValue":e[11]||(e[11]=l=>c.value=l),placeholder:"Techno, House, Ambient",class:"w-full"},null,8,["modelValue"]),e[27]||(e[27]=i("small",null,"Separati da virgola",-1))])]),i("div",Se,[i("div",Ue,[e[28]||(e[28]=i("label",{for:"status"},"Status",-1)),a(g,{id:"status",modelValue:t.value.status,"onUpdate:modelValue":e[12]||(e[12]=l=>t.value.status=l),options:I,optionLabel:"label",optionValue:"value",placeholder:"Seleziona status",class:"w-full"},null,8,["modelValue"])]),i("div",Ne,[e[30]||(e[30]=i("label",{for:"featured"},"In Evidenza",-1)),i("div",Te,[a(P,{id:"featured",modelValue:t.value.featured,"onUpdate:modelValue":e[13]||(e[13]=l=>t.value.featured=l),binary:!0},null,8,["modelValue"]),e[29]||(e[29]=i("label",{for:"featured"},"Mostra come episodio featured",-1))])])])])]),_:1},8,["visible","header"]),a(W),a(X)]),_:1})}}},Oe=me(ke,[["__scopeId","data-v-177e1a8e"]]);export{Oe as default};
