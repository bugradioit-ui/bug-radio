import{u as Y,D as ee}from"./DashboardLayout-wja6WQ8W.js";import{u as le}from"./episodes-CzvIcrbk.js";import{u as oe,a as te,n as ae,r as v,j as y,k as ie,l as se,w as r,e as s,p as re,o as de,d as t,b as i,h,i as T,t as k,s as ne,v as ue,x as I}from"./index-M06F_bbr.js";import{I as pe}from"./ImageUpload-7E4C_Hds.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ce={class:"filters"},ve={class:"stats-chips"},fe={class:"empty-state"},be={class:"action-buttons"},we={class:"dialog-content"},ge={class:"form-field"},ye={class:"form-row"},he={class:"form-field"},Ve={class:"form-field"},De={class:"form-field"},Ce={class:"form-field"},_e={class:"form-field"},xe={class:"form-row"},Ie={class:"form-field"},Ee={class:"form-field"},Se={class:"form-row"},Ue={class:"form-field"},Ne={class:"form-field"},Te={class:"checkbox-field"},ke={__name:"EpisodesView",setup(ze){const d=le(),V=Y();oe();const n=te(),z=ae(),f=v(!1),m=v(null),b=v(null),w=v(null),c=v(""),a=v({showId:"",title:"",episodeNumber:null,description:"",mixcloudUrl:"",image:{url:"",alt:""},airDate:new Date,genres:[],status:"draft",featured:!1}),E=[{label:"Bozza",value:"draft"},{label:"Pubblicato",value:"published"},{label:"Archiviato",value:"archived"}],L=y(()=>{let l=d.episodes;return b.value&&(l=l.filter(e=>e.showId?._id===b.value||e.showId===b.value)),w.value&&(l=l.filter(e=>e.status===w.value)),l}),$=y(()=>d.episodes.filter(l=>l.status==="published").length),M=y(()=>d.episodes.filter(l=>l.status==="draft").length),A=y(()=>d.episodes.filter(l=>l.featured).length),B=l=>({draft:"BOZZA",published:"PUBBLICATO",archived:"ARCHIVIATO"})[l]||l.toUpperCase(),O=l=>({draft:"secondary",published:"success",archived:"warning"})[l]||"info",F=l=>l?new Date(l).toLocaleDateString("it-IT",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",D=(l=null)=>{l?(m.value=l,a.value={showId:l.showId?._id||l.showId,title:l.title,episodeNumber:l.episodeNumber,description:l.description,mixcloudUrl:l.mixcloudUrl,image:{url:l.image?.url||"",alt:l.image?.alt||""},airDate:new Date(l.airDate),genres:l.genres||[],status:l.status,featured:l.featured},c.value=(l.genres||[]).join(", ")):(m.value=null,a.value={showId:"",title:"",episodeNumber:null,description:"",mixcloudUrl:"",image:{url:"",alt:""},airDate:new Date,genres:[],status:"draft",featured:!1},c.value=""),f.value=!0},q=async()=>{if(!a.value.showId||!a.value.title||!a.value.description||!a.value.mixcloudUrl){n.add({severity:"warn",summary:"Campi mancanti",detail:"Compila tutti i campi obbligatori",life:3e3});return}const l={showId:a.value.showId,title:a.value.title,episodeNumber:a.value.episodeNumber,description:a.value.description,mixcloudUrl:a.value.mixcloudUrl,image:a.value.image.url?a.value.image:void 0,airDate:a.value.airDate instanceof Date?a.value.airDate.toISOString():a.value.airDate,genres:c.value?c.value.split(",").map(e=>e.trim()).filter(e=>e):[],status:a.value.status,featured:a.value.featured};try{m.value?(await d.updateEpisode(m.value._id,l),n.add({severity:"success",summary:"Episodio aggiornato",detail:"Le modifiche sono state salvate",life:3e3})):(await d.createEpisode(l),n.add({severity:"success",summary:"Episodio creato",detail:"Il nuovo episodio è stato creato",life:3e3})),f.value=!1}catch{n.add({severity:"error",summary:"Errore",detail:d.error||"Errore durante il salvataggio",life:3e3})}},R=l=>{alert(`Dettagli episodio:

Titolo: ${l.title}
Show: ${l.showId?.title}
Mixcloud: ${l.mixcloudUrl}`)},j=l=>{z.require({message:`Sei sicuro di voler eliminare "${l.title}"?`,header:"Conferma Eliminazione",icon:"pi pi-exclamation-triangle",acceptLabel:"Sì, elimina",rejectLabel:"Annulla",acceptClass:"p-button-danger",accept:()=>G(l)})},G=async l=>{try{await d.deleteEpisode(l._id),n.add({severity:"success",summary:"Episodio eliminato",detail:"L'episodio è stato eliminato",life:3e3})}catch{n.add({severity:"error",summary:"Errore",detail:"Errore durante l'eliminazione",life:3e3})}};return ie(async()=>{try{await Promise.all([d.fetchEpisodes(),V.fetchShows()])}catch{n.add({severity:"error",summary:"Errore",detail:"Errore nel caricamento dei dati",life:3e3})}}),(l,e)=>{const u=s("Button"),g=s("Dropdown"),C=s("Chip"),S=s("Card"),p=s("Column"),U=s("Tag"),H=s("DataTable"),_=s("InputText"),Z=s("InputNumber"),J=s("Textarea"),K=s("Calendar"),P=s("Checkbox"),Q=s("Dialog"),W=s("ConfirmDialog"),X=s("Toast"),x=re("tooltip");return de(),se(ee,{"page-title":"Gestione Episodi"},{"topbar-actions":r(()=>[t(u,{label:"Nuovo Episodio",icon:"pi pi-plus",onClick:e[0]||(e[0]=o=>D())})]),default:r(()=>[t(S,{class:"filters-card"},{content:r(()=>[i("div",ce,[t(g,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=o=>b.value=o),options:h(V).shows.filter(o=>o.status==="active"),optionLabel:"title",optionValue:"_id",placeholder:"Filtra per Show",showClear:"",class:"filter-dropdown"},null,8,["modelValue","options"]),t(g,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=o=>w.value=o),options:E,optionLabel:"label",optionValue:"value",placeholder:"Filtra per Status",showClear:"",class:"filter-dropdown"},null,8,["modelValue"]),i("div",ve,[t(C,{label:`${$.value} Pubblicati`,icon:"pi pi-check-circle"},null,8,["label"]),t(C,{label:`${M.value} Bozze`,icon:"pi pi-pencil"},null,8,["label"]),t(C,{label:`${A.value} In evidenza`,icon:"pi pi-star-fill"},null,8,["label"])])])]),_:1}),t(S,null,{content:r(()=>[t(H,{value:L.value,loading:h(d).loading,paginator:"",rows:15,stripedRows:"",sortField:"airDate",sortOrder:-1},{empty:r(()=>[i("div",fe,[e[16]||(e[16]=i("i",{class:"pi pi-play-circle",style:{"font-size":"3rem",color:"#cbd5e1"}},null,-1)),e[17]||(e[17]=i("p",null,"Nessun episodio trovato",-1)),t(u,{label:"Crea il primo episodio",icon:"pi pi-plus",onClick:e[3]||(e[3]=o=>D())})])]),default:r(()=>[t(p,{field:"title",header:"Titolo",sortable:"",style:{"min-width":"200px"}}),t(p,{field:"showId.title",header:"Show",sortable:""},{body:r(o=>[t(U,{value:o.data.showId?.title||"-",severity:"info"},null,8,["value"])]),_:1}),t(p,{field:"episodeNumber",header:"#",sortable:"",style:{width:"80px"}},{body:r(o=>[T(k(o.data.episodeNumber||"-"),1)]),_:1}),t(p,{field:"airDate",header:"Data Messa in Onda",sortable:""},{body:r(o=>[T(k(F(o.data.airDate)),1)]),_:1}),t(p,{field:"status",header:"Status",sortable:""},{body:r(o=>[t(U,{value:B(o.data.status),severity:O(o.data.status)},null,8,["value","severity"])]),_:1}),t(p,{field:"featured",header:"Featured",sortable:"",style:{width:"100px"}},{body:r(o=>[i("i",{class:ue(o.data.featured?"pi pi-star-fill":"pi pi-star"),style:ne({color:o.data.featured?"#f59e0b":"#cbd5e1",fontSize:"1.2rem"})},null,6)]),_:1}),t(p,{header:"Azioni",style:{width:"200px"}},{body:r(o=>[i("div",be,[I(t(u,{icon:"pi pi-eye",rounded:"",outlined:"",severity:"info",onClick:N=>R(o.data)},null,8,["onClick"]),[[x,"Dettagli",void 0,{top:!0}]]),I(t(u,{icon:"pi pi-pencil",rounded:"",outlined:"",severity:"secondary",onClick:N=>D(o.data)},null,8,["onClick"]),[[x,"Modifica",void 0,{top:!0}]]),I(t(u,{icon:"pi pi-trash",rounded:"",outlined:"",severity:"danger",onClick:N=>j(o.data)},null,8,["onClick"]),[[x,"Elimina",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","loading"])]),_:1}),t(Q,{visible:f.value,"onUpdate:visible":e[15]||(e[15]=o=>f.value=o),header:m.value?"Modifica Episodio":"Nuovo Episodio",modal:!0,style:{width:"800px"},maximizable:!0},{footer:r(()=>[t(u,{label:"Annulla",severity:"secondary",onClick:e[14]||(e[14]=o=>f.value=!1),outlined:""}),t(u,{label:m.value?"Salva Modifiche":"Crea Episodio",onClick:q,loading:h(d).loading},null,8,["label","loading"])]),default:r(()=>[i("div",we,[i("div",ge,[e[18]||(e[18]=i("label",{for:"showId"},"Show *",-1)),t(g,{id:"showId",modelValue:a.value.showId,"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.showId=o),options:h(V).shows.filter(o=>o.status==="active"),optionLabel:"title",optionValue:"_id",placeholder:"Seleziona lo show",required:"",class:"w-full"},null,8,["modelValue","options"])]),i("div",ye,[i("div",he,[e[19]||(e[19]=i("label",{for:"title"},"Titolo Episodio *",-1)),t(_,{id:"title",modelValue:a.value.title,"onUpdate:modelValue":e[5]||(e[5]=o=>a.value.title=o),placeholder:"Es. Episode #12 - Deep Techno Night",required:"",class:"w-full"},null,8,["modelValue"])]),i("div",Ve,[e[20]||(e[20]=i("label",{for:"episodeNumber"},"Numero Episodio",-1)),t(Z,{id:"episodeNumber",modelValue:a.value.episodeNumber,"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.episodeNumber=o),placeholder:"12",min:1,class:"w-full"},null,8,["modelValue"])])]),i("div",De,[e[21]||(e[21]=i("label",{for:"description"},"Descrizione *",-1)),t(J,{id:"description",modelValue:a.value.description,"onUpdate:modelValue":e[7]||(e[7]=o=>a.value.description=o),rows:"4",placeholder:"Descrivi l'episodio, la tracklist, gli ospiti...",required:"",class:"w-full"},null,8,["modelValue"])]),i("div",Ce,[e[22]||(e[22]=i("label",{for:"mixcloudUrl"},"Mixcloud URL *",-1)),t(_,{id:"mixcloudUrl",modelValue:a.value.mixcloudUrl,"onUpdate:modelValue":e[8]||(e[8]=o=>a.value.mixcloudUrl=o),placeholder:"https://www.mixcloud.com/username/episode-name/",required:"",class:"w-full"},null,8,["modelValue"]),e[23]||(e[23]=i("small",null,"URL completo del mix su Mixcloud",-1))]),i("div",_e,[t(pe,{label:"Immagine Episodio (opzionale)",modelValue:a.value.image.url,"onUpdate:modelValue":e[9]||(e[9]=o=>a.value.image.url=o)},null,8,["modelValue"]),e[24]||(e[24]=i("small",null,"Se non specificata, verrà usata l'immagine dello show",-1))]),i("div",xe,[i("div",Ie,[e[25]||(e[25]=i("label",{for:"airDate"},"Data Messa in Onda *",-1)),t(K,{id:"airDate",modelValue:a.value.airDate,"onUpdate:modelValue":e[10]||(e[10]=o=>a.value.airDate=o),showTime:"",hourFormat:"24",dateFormat:"dd/mm/yy",showIcon:"",class:"w-full"},null,8,["modelValue"])]),i("div",Ee,[e[26]||(e[26]=i("label",{for:"genres"},"Generi Musicali",-1)),t(_,{id:"genres",modelValue:c.value,"onUpdate:modelValue":e[11]||(e[11]=o=>c.value=o),placeholder:"Techno, House, Ambient",class:"w-full"},null,8,["modelValue"]),e[27]||(e[27]=i("small",null,"Separati da virgola",-1))])]),i("div",Se,[i("div",Ue,[e[28]||(e[28]=i("label",{for:"status"},"Status",-1)),t(g,{id:"status",modelValue:a.value.status,"onUpdate:modelValue":e[12]||(e[12]=o=>a.value.status=o),options:E,optionLabel:"label",optionValue:"value",placeholder:"Seleziona status",class:"w-full"},null,8,["modelValue"])]),i("div",Ne,[e[30]||(e[30]=i("label",{for:"featured"},"In Evidenza",-1)),i("div",Te,[t(P,{id:"featured",modelValue:a.value.featured,"onUpdate:modelValue":e[13]||(e[13]=o=>a.value.featured=o),binary:!0},null,8,["modelValue"]),e[29]||(e[29]=i("label",{for:"featured"},"Mostra come episodio featured",-1))])])])])]),_:1},8,["visible","header"]),t(W),t(X)]),_:1})}}},Oe=me(ke,[["__scopeId","data-v-918c2ea7"]]);export{Oe as default};
